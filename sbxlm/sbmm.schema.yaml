# Rime schema
# encoding: utf-8

__include: sbxlm.yaml:/prelude

schema:
  schema_id: sbmm
  name: "声笔猛码"
  version: "11.0"
  icon: "sbxlm.ico"
  author:
    - 戴石麟 <https://sbxlm.github.io>
  dependencies:
    - sbyp
    - bihua
    - sbmm2

switches:
  - name: ascii_mode
    reset: 0
    states: [中文, 西文]
  - name: ascii_punct
    reset: 0
    states: [。，, ．，]
  - name: zh_trad
    reset: 0
    states: [简体, 繁体]
  # 为了避免拥挤，不显示下面的状态
  - name: auto_inline
    reset: 1
  - name: is_buffered
    reset: 0
  - options: [pro_word, pro_char]
    reset: 1
  # states: [词组, 单字]
  - name: show_es
    reset: 1
  # 不要改变下面的状态，以免穿帮
  - name: third_pop
    reset: 0
  - name: fast_pop
    reset: 0

engine:
  processors:
    - lua_processor@*sbxlm.ascii_composer
    - ascii_composer
    - recognizer
    - lua_processor@*sbxlm.key_binder
    - key_binder
    - lua_processor@*sbxlm.selector
    - lua_processor@*sbxlm.popping
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@bihua
    - affix_segmentor@sbyp
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - lua_translator@*sbxlm.auto_length
    - table_translator@bihua
    - script_translator@sbyp
    - history_translator
  filters:
    - simplifier@es_conversion
    - reverse_lookup_filter@reverse_lookup
    - reverse_lookup_filter@reverse_lookup2
    - lua_filter@*sbxlm.hint
    - lua_filter@*sbxlm.select_key_to_comment
    - simplifier
    - uniquifier

popping:
  __append:
    # 词组模式
    # 单字模式
    - match: "[a-z]{3}"
      accept: "[a-z0-9]"
      prefix: 2
    - match: "[a-z]{2}"
      accept: "[0-9]"
      prefix: 1
    # 不论模式
    - match: "[a-z][0-9]"
      accept: "[a-z]"
    - match: "[a-z]{2,3}[;',./]"
      accept: "[a-z;',./0-9]"
    - match: "[a-z]"
      accept: "[;',./]"
    - match: "[^a-z]"
      accept: "[^ ]"

speller:
  alphabet: "bpmfdtnlgkhjqxzcsrywvaeiou0123456789;',./"
  initials: "bpmfdtnlgkhjqxzcsrywvaeiou"
  auto_clear: none
  max_code_length: 4
  auto_select: true
  auto_select_pattern: "^[a-z][0-9]|[a-z]{2}[;',./]$"
  popping:
    __patch:
      - /popping

translator:
  dictionary: sbmm
  enable_user_dict: true
  enable_filtering: true
  filter_strength: 4    #可以为3,4,5,6 
  forced_selection: true
  single_selection: false
  enable_encoder: true
  stop_change: false
  delete_threshold: 2000
  max_phrase_length: 5
  disable_user_dict_for_patterns:
    - "[a-z][0-9]?"
    - "[a-z]{2,3}[;',./]?"

extended:
  dictionary: sbmm.extended
  user_dictionary: "sbmm"
  enable_user_dict: true

history:
  tag: history
  input: "/"
  size: 5
  initial_quality: -1

bihua:
  tag: bihua
  dictionary: bihua
  enable_user_dict: false
  enable_encoder: false
  enable_sentence: false
  strict_spelling: true
  enable_completion: true
  encode_commit_history: false
  prefix: "="
  tips: "〔笔画反查〕"

sbyp:
  tag: sbyp
  dictionary: sbpy
  enable_user_dict: false
  enable_encoder: false
  packs:
    - sbpy.base
  prism: sbyp
  prefix: "="
  tips: "〔拼音反查〕"

punctuator:
  import_preset: sbxlm

recognizer:
  patterns:
    punct: '^\\([0-9]|10|[A-Za-z][A-Zbpmfdtnlgkhjqxzcsrywv]*)$'
    bihua: "^=[aeiou]+$"
    sbyp: "^=[bpmfdtnlgkhjqxzcsrywv][a-z']*$"
    history: "^/$"

sbmm_bindings:
  __append:
    - match: "[a-z]{1,2}"
      accept: "6"
      send_sequence: "5"
    - match: "[a-z]{1,2}"
      accept: "7"
      send_sequence: "4"
    - match: "[a-z]{1,2}"
      accept: "8"
      send_sequence: "3"
    - match: "[a-z]{1,2}"
      accept: "9"
      send_sequence: "2"
    - match: "[a-z]{1,2}"
      accept: "0"
      send_sequence: "1"
    - match: "[a-z]{3}"
      accept: "Shift+space"
      send_sequence: "{Home}{Right}{space}{space}"

key_binder:
  bindings:
    __patch:
      - sbxlm.yaml:/rime_key_bindings
      - /sbmm_bindings

reverse_lookup:
  tags: [bihua, sbyp]
  overwrite_comment: true
  dictionary: sbmm.extended

reverse_lookup2:
  tags: [bihua, sbyp]
  overwrite_comment: true
  dictionary: sbmm

menu:
  page_size: 6
  alternative_select_keys: "_12345"
  alternative_select_labels: ["", "", "", "", "", ""]
  alternative_select_patterns:
    - "[a-z]{3}[;',./]"
  select_comment_pattern: "^[a-z]{3}[;',./]$"
